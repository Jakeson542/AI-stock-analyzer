<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Stock Analyzer</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 40px auto; padding: 0 20px; }
    h1 { text-align: center; }
    #stockInput { padding: 10px; font-size: 1.2em; width: 150px; }
    #analyzeBtn { padding: 10px 15px; font-size: 1em; }
    #result { margin-top: 20px; border: 1px solid #ddd; border-radius: 8px; padding: 20px; }
    #stockData { margin-bottom: 20px; }
    #loading { color: gray; }
  </style>
</head>
<body>

  <h1>AI Stock Analyzer</h1>

  <input id="stockInput" placeholder="Enter ticker (e.g. AAPL)" />
  <button id="analyzeBtn">Analyze</button>

  <div id="result"></div>

  <script>
    const OPENAI_API_KEY = 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; // Replace with your OpenAI key

    document.getElementById('analyzeBtn').onclick = async () => {
      const ticker = document.getElementById('stockInput').value.trim().toUpperCase();
      if (!ticker) {
        alert('Please enter a stock ticker symbol');
        return;
      }
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<p id="loading">Fetching data and analyzing...</p>';

      try {
        // Fetch stock data from free API - Yahoo Finance unofficial API (no key needed)
        const response = await fetch(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${ticker}`);
        const data = await response.json();

        if (!data.quoteResponse.result.length) {
          resultDiv.innerHTML = '<p>Invalid ticker symbol or no data found.</p>';
          return;
        }

        const stock = data.quoteResponse.result[0];

        // Prepare text to send to OpenAI
        const prompt = `Provide a concise and clear summary of the stock ${ticker} based on this data:
        - Current price: $${stock.regularMarketPrice}
        - Day high: $${stock.regularMarketDayHigh}
        - Day low: $${stock.regularMarketDayLow}
        - Market change percent: ${stock.regularMarketChangePercent.toFixed(2)}%
        - Volume: ${stock.regularMarketVolume.toLocaleString()}
        Give a simple analysis and what investors should watch for.`;

        // Call OpenAI API
        const openaiResponse = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({
            model: 'gpt-3.5-turbo',
            messages: [{ role: 'user', content: prompt }],
            max_tokens: 200,
          }),
        });
        const openaiData = await openaiResponse.json();

        const aiAnalysis = openaiData.choices[0].message.content.trim();

        // Show results
        resultDiv.innerHTML = `
          <div id="stockData">
            <h2>${ticker} Stock Data</h2>
            <p><strong>Current Price:</strong> $${stock.regularMarketPrice}</p>
            <p><strong>Day High:</strong> $${stock.regularMarketDayHigh}</p>
            <p><strong>Day Low:</strong> $${stock.regularMarketDayLow}</p>
            <p><strong>Change %:</strong> ${stock.regularMarketChangePercent.toFixed(2)}%</p>
            <p><strong>Volume:</strong> ${stock.regularMarketVolume.toLocaleString()}</p>
          </div>
          <div id="aiAnalysis">
            <h2>AI Analysis</h2>
            <p>${aiAnalysis}</p>
          </div>
        `;
      } catch (err) {
        resultDiv.innerHTML = `<p>Error: ${err.message}</p>`;
      }
    };
  </script>
</body>
</html>
